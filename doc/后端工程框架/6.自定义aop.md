# 自定义注解

实现API请求日志切面

这一部分很基础。如果说config和filter是针对框架所添加的功能，那么AOP就是针对方法实现的方法拓展。

当然要说动态代理可以不，也可以，就是很操蛋不是么。



表面上很简单，然后修bug又差点上天，

先说怎么使用，在这一章节中，先自定义了切面，也就是定义了元注解，然后在写aspect。因为这里都有对应的代码版本，写一章节就提交一次，所以具体的增添了什么就不谈。

我们学习AOP的时候，教过是写元注解的方式，然后后续的实现也是通过各种注解完成。这很简单。



好了，我修完bug回来了。遇到一个十分叼毛的事，关于启动的事，因为最开始照着教程写的，然后现阶段就出了bug，什么bug，就是无法创建我们自定义的bean，也就是我们这一章节创建的AOP的代码，我们的流程是这样的，首先在common类下`pom.xml`文件中导入我们所依赖的组件，也就是`spring boot start aop`这玩意儿，因为还涉及到了序列化和反序列化，额外引入了`jackson`这个组件，这个问题不大，父类的依赖管理中不需要引入版本管理，只需要引入`jackson`的版本管理，因为这玩意儿不属于parent能解决的事。

所以我们在父类中引入`jackson`的版本管理，引入这个组件，`common`类中引入`aop`和 `jackson`，然后正常写我们的元注解和`aspect`这个玩意儿，具体写法和优化我做了解释，同样在最上面引入了`@Component`按理来说，这玩意儿已经实现了单例对象，因为该有的注解都有嘛，

然后就是神奇的事，启动竟然报错了，无法引入我们创建的元注解，这时候是不是已经发现不对劲了，并且还不会修，为什么呢，因为元注解跟AOP事强关联的，也就是说意味着我们没有正确引入AOP的组件，可是版本管理什么的，我们都做的很好，这不应该啊。

于是就开始了疯狂修代码，这里添加组件，别的地方添加依赖，甚至单独的把这个依赖写出来，依旧是报错。

那么这个时候就在想，肯定不在common类中出问题，因为要是那里出问题，爆红的都拦不住，那只有在使用的地方不对，我们是在controller中引入了这个注解，那就试试看，在web的类下引入AOP的组件，神奇的事就来了，他就正常了，并且怎么修都无法复现这个bug。

然后事情就这么莫名其妙的结束了。

这就是正常返回![image-20241010051608652](https://cdn.jsdelivr.net/gh/Mirror18/imgage@main//202410100516785.png)

不过先说一下这是怎么调用的，有两种，一个是`postman`这个软件调用，

![image-20241010051645676](https://cdn.jsdelivr.net/gh/Mirror18/imgage@main//202410100516757.png)

另一个是idea自带的，不过要写的麻烦点

![image-20241010051736864](https://cdn.jsdelivr.net/gh/Mirror18/imgage@main//202410100517894.png)

即 下面要接参数的，

同样也测出这个有什么用，就`@ComponentScan`这个是扫描所有包下面的自定义bean。如果没有的话AOP功能就不能开启。

还有另外一种开启方法，不过因为这种放的位置的事，没办法在这里用

![image-20241010052003975](https://cdn.jsdelivr.net/gh/Mirror18/imgage@main//202410100520002.png)

就是在pointcut这里添加一个execution，添加我们用AOP的位置，因为不在同一个模块中，无法开启，所以就这么算了，但是我们要知道对不。

然后这就是我这一章节所得的感悟。